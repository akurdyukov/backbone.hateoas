!function(a,b){if("function"==typeof define&&define.amd)define(["backbone","underscore","backbone.paginator"],function(c,e,f){return a.Hal=b(a,c,d,f)});else if("undefined"!=typeof exports){var c=require("backbone"),d=require("underscore"),e=require("backbone.paginator");module.exports=b(a,c,d,e)}else a.Hal=b(a,a.Backbone,a._,a.PageableCollection)}(this,function(){"use strict";var a={};return a.Link=Backbone.Model.extend({createModel:function(){return new a.Model({id:parseInt(this.get("href").split("/").pop(),10)})},initialize:function(a){if(_.isNull(a)||_.isUndefined(a)||_.isNull(a.href)||_.isUndefined(a.href))throw new Error('Missing required property "href" !')},getDeprecation:function(){return this.get("deprecation")},getName:function(){return this.get("name")},isTemplated:function(){return this.get("templated")},getHref:function(){return this.get("href")},getHreflang:function(){return this.get("hreflang")},getProfile:function(){return this.get("profile")},getTitle:function(){return this.get("title")},getType:function(){return this.get("type")},setDeprecation:function(a){this.set("deprecation",a)},setHref:function(a){this.set("href",a)},setHreflang:function(a){this.set("hreflang",a)},setName:function(a){this.set("name",a)},setProfile:function(a){this.set("profile",a)},setTemplated:function(a){this.set("templated",a)},setTitle:function(a){this.set("title",a)},setType:function(a){this.set("type",a)}}),a.Model=Backbone.Model.extend({getLink:function(a){return this.get("_links").get(a)},getLinks:function(){return this.get("_links")}}),a.Model.prototype.getEmbedded=function(a){return this.get("_embedded").get(a)},a.Model.prototype.url=function(){if(this.get("_links")&&this.get("_links").get("self")&&this.get("_links").get("self").get("href"))return this.get("_links").get("self").get("href");if(!this.halResourceName)throw new Error("A 'halResourceName' parameter is required !");var a=this.urlRoot;return"/"!==this.urlRoot.slice(-1)&&(a+="/"),a+=this.halResourceName,this.has("id")&&(a=a+"/"+this.get("id")),this.queryParams&&(a=a+"?"+$.param(this.queryParams)),a},a.Model.prototype.parse=function(b,c){var d=_.omit(b,"_links","_embedded");return c.patch&&0===_.size(d)?d:(d._embedded=new a.Model,_.map(b._embedded,function(b,c){var e=null;if(_.isArray(b))if(this.hal&&this.hal[c]){var f=this.hal[c].type;e=new f(b,{mode:"server",model:this.hal[c].model,parse:!0})}else e=new Backbone.Collection(b,{mode:"server",model:a.Model,parse:!0});else e=new a.Model(b,{parse:!0});d._embedded.set(c,e),this.set(c,e)},this),d._links=new a.Model,_.map(b._links,function(b,c){d._links.set(c,new a.Link(b))},this),d)},a.Model.prototype.toJSON=function(){var a=_.omit(this.attributes,"_links","_embedded"),b={};if(b._embedded={},b._links={},_.each(a,function(a,c){_.isArray(a)?(b[c]=[],_.each(a,function(a){_.isObject(a)&&a instanceof Backbone.Collection?b[c].push(a.toJSON()):b[c]=a})):_.isObject(a)?(a instanceof Backbone.Model||a instanceof Backbone.Collection)&&(b[c]=a.toJSON()):b[c]=a}),_.has(this.attributes,"_embedded")){var c=this.attributes._embedded;_.each(c.attributes,function(a,c){(a instanceof Backbone.Model||a instanceof Backbone.Collection)&&(b._embedded[c]=a.toJSON())})}if(_.has(this.attributes,"_links")){var d=this.attributes._links;_.each(d.attributes,function(a,c){a instanceof Backbone.Model&&(b._links[c]={href:a.get("href")})})}return b},a.Collection=Backbone.PageableCollection.extend({mode:"infinite",model:a.Model,queryParams:{currentPage:"page",pageSize:"page_size",totalPages:null,totalRecords:null},state:{firstPage:1,pageSize:12},parseLinks:function(a){if(!a._links.first&&"infinite"===this.mode&&0!==a.total_items)throw new Error("You are using the 'infinite' mode and the server did not returned a 'first' link attached to the HAL Collection. Check if the collection URL is correct and the payload is well formed. If your collection is not paginated you could use the 'server' mode instead.");if(!a._links.last&&"infinite"===this.mode&&0!==a.total_items)throw new Error("You are using the 'infinite' mode and the server did not returned a 'last' link attached to the HAL Collection. Check if the collection URL is correct and the payload is well formed. If your collection is not paginated you could use the 'server' mode instead.");var b={};return 0!==a.total_items&&(b.first=a._links.first.href,b.last=a._links.last.href),a._links.next&&(b.next=a._links.next.href),a._links.prev&&(b.prev=a._links.prev.href),b},parseRecords:function(a){if(!this.halCollectionName)throw new Error("A 'halCollectionName' parameter is required !");return a._embedded[this.halCollectionName]},parseState:function(a){return{totalItems:a.total_items}},getPage:function(a,b){var c=this.mode,d=this.fullCollection;b=b||{fetch:!1};var e=this.state,f=e.firstPage,g=e.currentPage,h=e.lastPage,i=e.pageSize,j=a;switch(a){case"first":j=f;break;case"prev":j=g-1;break;case"next":j=g+1;break;case"last":j=h;break;default:j=finiteInt(a,"index")}this.state=this._checkState(_.extend({},e,{currentPage:j})),b.from=g,b.to=j;var k=(0===f?j:j-1)*i,l=d&&d.length?d.models.slice(k,k+i):[];return"client"!=c&&("infinite"!=c||_.isEmpty(l))||b.fetch?("infinite"==c&&(b.url=this.links[j]),this.fetch(_.omit(b,"fetch"))):(this.reset(l,_.omit(b,"fetch")),b.success(l,null,b),this)}}),a});
//# sourceMappingURL=backbone.hateoas.min.js.map