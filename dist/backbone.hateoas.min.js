!function(a,b){if("function"==typeof define&&define.amd)define(["backbone","underscore","backbone.paginator"],function(c,d,e){return c.PageableCollection=e,a.Hal=b(a,c,d)});else if("undefined"!=typeof exports){var c=require("backbone"),d=require("underscore");c.PageableCollection=require("backbone.paginator"),module.exports=b(a,c,d)}else a.Hal=b(a,a.Backbone,a._)}(this,function(a,b,c){"use strict";var d={};return d.Embedded=b.Model.extend({initialize:function(a,b){c.map(a,function(a,e){var f=null;if(this.embedded)if(c.isFunction(this.embedded[e]))f=this.embedded[e](e,a,b);else if(this.embedded[e]instanceof d.Collection)f=new d.Collection(a);else{if(!(this.embedded[e]instanceof d.Model))throw new Error("Invalid embedded model or collection class provided for 'rel'='"+e+"' !");f=new d.Model(a)}else if(c.isArray(a))f=[],c.each(a,function(a){f.push(new d.Model(a))});else{if(!c.isObject(a))throw new Error("Invalid embedded resource identified by 'rel'='"+e+"' !");f=new d.Model(a)}this.set(e,f)},this)},toJSON:function(){var a={};for(var b in this.attributes){var d=this.attributes[b];if(c.isArray(d)){a[b]=[];for(var e=0;e<d.length;++e)a[b].push(d[e].toJSON())}else a[b]=this.attributes[b].toJSON()}return a}}),d.Link=b.Model.extend({_templated:void 0,createModel:function(){return new d.Model({id:parseInt(this.get("href").split("/").pop(),10)})},initialize:function(a){if(!c.isObject(a)||!c.isString(a.href))throw new Error('Missing required property "href" !');this._templated=this.get("templated"),this.attributes.templated=this._templated===!0,this.on("change:templated",function(a,b){this._templated=b},this)},getDeprecation:function(){return this.get("deprecation")},getName:function(){return this.get("name")},getHref:function(){return this.get("href")},getHreflang:function(){return this.get("hreflang")},getProfile:function(){return this.get("profile")},getTitle:function(){return this.get("title")},getType:function(){return this.get("type")},isArray:function(){return!1},isTemplated:function(){return this.get("templated")},setDeprecation:function(a){this.set("deprecation",a)},setHref:function(a){this.set("href",a)},setHreflang:function(a){this.set("hreflang",a)},setName:function(a){this.set("name",a)},setProfile:function(a){this.set("profile",a)},setTemplated:function(a){this.set("templated",a)},setTitle:function(a){this.set("title",a)},setType:function(a){this.set("type",a)},toJSON:function(){return c.isUndefined(this._templated)&&delete this.attributes.templated,b.Model.prototype.toJSON.apply(this)}}),d.LinkArray=b.Collection.extend({model:d.Link,initialize:function(a,d){if(!c.isArray(a)||0===a.length)throw new Error("A LinkArray MUST BE created with at least one link model !");return b.Collection.prototype.initialize.apply(this,a,d)},isArray:function(){return!0}}),d.Links=b.Model.extend({initialize:function(a){c.map(a,function(a,b){this.set(b,c.isArray(a)?new d.LinkArray(a):new d.Link(a))},this)},getSelf:function(){return this.get("self")},hasSelf:function(){var a=this.getSelf();return!(c.isNull(a)||c.isUndefined(a))},toJSON:function(){var a={};for(var b in this.attributes)a[b]=this.attributes[b].toJSON();return a}}),d.Model=b.Model.extend({_links:null,_embedded:null,getEmbedded:function(a){var b=this._embedded;return c.isString(a)&&(b=b.get(a)),b},unsetEmbedded:function(a,b){this.getEmbedded().unset(a,b)},getLink:function(a){return this.getLinks().get(a)},getLinks:function(){return this._links},initialize:function(){this._links||(this._links=new d.Links),this._embedded||(this._embedded=new d.Embedded)},toJSON:function(){var a=c.isEmpty(this.getLinks().attributes),b=c.isEmpty(this.getEmbedded().attributes),d=null;return d=a&&b?c.clone(this.attributes):a?c.extend(this.attributes,{_embedded:this.getEmbedded().toJSON()}):b?c.extend(this.attributes,{_links:this.getLinks().toJSON()}):c.extend(c.clone(this.attributes),{_embedded:this.getEmbedded().toJSON(),_links:this.getLinks().toJSON()})},set:function(a,e,f){var g,h;if(null===a)return this;if("object"==typeof a?(g=a,f=e):(g={})[a]=e,g._links)if(this._links)for(h in g._links)this._links.set(h,g._links[h]);else this._links=new d.Links(g._links);if(g._embedded)if(this._embedded)for(h in g._embedded)this._embedded.set(h,g._embedded[h]);else this._embedded=new d.Embedded(g._embedded);return g=c.omit(g,"_links","_embedded"),b.Model.prototype.set.call(this,g,e,f)},url:function(){if(this.getLinks().hasSelf())return this.getLinks().getSelf().getHref();var a=c.result(this,"urlRoot")||c.result(this.collection,"url"),b=c.result(d,"urlRoot"),e=c.result(this,"urlMiddle");if(!a&&c.isString(b)&&(a=b,c.isString(e)&&(a=a.replace(/([^\/])$/,"$1/")+encodeURIComponent(e))),!a)throw new Error('A "url" property or function must be specified');if(this.isNew())return a;var f=this.id||this.attributes[this.idAttribute];return a.replace(/([^\/])$/,"$1/")+encodeURIComponent(f)}}),function(){function a(a,b){if(!c.isNumber(a)||c.isNaN(a)||!c.isFinite(a)||~~a!==a)throw new TypeError("`"+b+"` must be a finite integer");return a}d.Collection=b.PageableCollection.extend({mode:"infinite",model:d.Model,queryParams:{currentPage:"page",pageSize:"page_size",totalPages:null,totalRecords:null},state:{firstPage:1,pageSize:12},parseLinks:function(a){if(!a._links.first&&"infinite"===this.mode&&0!==a.total_items)throw new Error("You are using the 'infinite' mode and the server did not returned a 'first' link attached to the HAL Collection. Check if the collection URL is correct and the payload is well formed. If your collection is not paginated you could use the 'server' mode instead.");if(!a._links.last&&"infinite"===this.mode&&0!==a.total_items)throw new Error("You are using the 'infinite' mode and the server did not returned a 'last' link attached to the HAL Collection. Check if the collection URL is correct and the payload is well formed. If your collection is not paginated you could use the 'server' mode instead.");var b={};return 0!==a.total_items&&(b.first=a._links.first.href,b.last=a._links.last.href),a._links.next&&(b.next=a._links.next.href),a._links.prev&&(b.prev=a._links.prev.href),b},parseRecords:function(a){if(!this.rel)throw new Error("A 'rel' parameter is required !");return a._embedded[this.rel]},parseState:function(a){return{totalItems:a.total_items}},getPage:function(b,d){var e=this.mode,f=this.fullCollection;d=d||{fetch:!1};var g=this.state,h=g.firstPage,i=g.currentPage,j=g.lastPage,k=g.pageSize,l=b;switch(b){case"first":l=h;break;case"prev":l=i-1;break;case"next":l=i+1;break;case"last":l=j;break;default:l=a(b,"index")}this.state=this._checkState(c.extend({},g,{currentPage:l})),d.from=i,d.to=l;var m=(0===h?l:l-1)*k,n=f&&f.length?f.models.slice(m,m+k):[];return"client"!=e&&("infinite"!=e||c.isEmpty(n))||d.fetch?("infinite"==e&&(d.url=this.links[l]),this.fetch(c.omit(d,"fetch"))):(this.reset(n,c.omit(d,"fetch")),d.success(n,null,d),this)}})}(),d});
//# sourceMappingURL=backbone.hateoas.min.js.map